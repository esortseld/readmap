<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>気分で選ばない読書地図 – すやネコ文庫</title>
<meta name="description" content="気分に頼らず、客観指標で読みたい本を探す『読書地図』。作品カードやデータへの入り口。">
<style>
  :root{
    --bg:#faf8f6; --card:#fff; --ink:#222; --sub:#555; --line:#eee; --btnbg:#f3f1ef;
    --book-w:168px; --book-ratio:2/3;
    --obi-color:#c8c8c8; --obi-thick:8px; --obi-bottom:65%;
  }
  *{box-sizing:border-box}
  body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,"Noto Sans JP",sans-serif;color:var(--ink);background:var(--bg)}
  header{padding:48px 16px;background:linear-gradient(180deg,#f8efe8,transparent)}
  .wrap{max-width:960px;margin:0 auto;padding:0 16px}
  h1{margin:0 0 8px;font-size:clamp(1.6rem,3.5vw,2.4rem)}
  .tagline{margin:0;color:var(--sub)}
  .hero{margin-top:18px;display:flex;flex-wrap:wrap;gap:10px}
  .btn{display:inline-block;padding:12px 16px;border-radius:12px;border:1px solid var(--line);background:var(--btnbg);color:var(--ink);text-decoration:none;font-weight:600}
  main{padding:24px 0}
  .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:16px}
  .card{background:var(--card);border:1px solid var(--line);border-radius:14px;padding:16px}
  .card h3{margin:0 0 6px;font-size:1.05rem}
  .card p{margin:0;color:var(--sub)}
  footer{padding:28px 16px;color:#777}

  /* 表紙カード */
  .books{display:grid;grid-template-columns:repeat(auto-fill, minmax(var(--book-w), var(--book-w)));gap:16px;margin-top:14px;justify-content:start}
  .book{position:relative;display:block;width:var(--book-w);aspect-ratio:var(--book-ratio);text-decoration:none;color:inherit;background:var(--card);border:1.5px solid var(--line);border-radius:10px;padding:14px 12px 14px 16px;box-shadow:0 2px 0 rgba(0,0,0,.03);transition:transform .12s ease, box-shadow .12s ease, background .2s;overflow:hidden}
  .book:before{content:"";position:absolute;left:0;top:0;bottom:0;width:8px;background:linear-gradient(90deg, rgba(0,0,0,.06), transparent);border-top-left-radius:10px;border-bottom-left-radius:10px}
  .book:hover{transform:translateY(-2px);box-shadow:0 6px 14px rgba(0,0,0,.06)}
  .book .title{font-weight:700;font-size:1rem;line-height:1.35;margin:0 0 6px;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}
  .book .author{color:var(--sub);font-size:.9rem;line-height:1.4;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
  .book .obi{position:absolute;left:12px;right:12px;bottom:var(--obi-bottom);height:var(--obi-thick);background:var(--obi-color)}
  .book.empty{pointer-events:none}

  @media (prefers-color-scheme: dark){
    :root{--bg:#0f0e0e;--card:#151515;--ink:#eee;--sub:#aaa;--line:#2a2a2a;--btnbg:#1a1a1a;--obi-color:#6a6a6a}
    header{background:linear-gradient(180deg,#1a1816,transparent)}
  }
</style>
</head>
<body>
  <header>
    <div class="wrap">
      <h1>気分で選ばない読書地図</h1>
      <p class="tagline">好みではなく「情報/条件」で探す、すやネコ文庫の小さなデータ図鑑。</p>

      <div class="hero">
        <a class="btn" href="./">ホーム</a>
        <a class="btn" href="https://esortseld.github.io/suyaneko_bunko/">すやネコ文庫（トップ）</a>
      </div>

      <div class="books" id="books"></div>
    </div>
  </header>

  <main class="wrap">
    <section class="grid">
      <article class="card">
        <h3>このサイトについて</h3>
        <p>客観データ（刊行年・出版社・語り/構造 など）で本を探せるように整理しています。主観メモは枠を分けて明記します。</p>
      </article>
      <article class="card">
        <h3>運用メモ</h3>
        <p>更新はGitHubでHTMLやCSVを差し替えるだけ。YouTubeやInstagramからこのページへ誘導します。</p>
      </article>
    </section>
  </main>

  <footer><div class="wrap"><small>© すやネコ文庫 / Reading Map</small></div></footer>

  <!-- CSV読み込み -->
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js" crossorigin="anonymous"></script>
  <script>
    const CSV_URL = 'data/works.csv';

    // 列名のゆれ対応（slugは英数字のみを想定）
    const ALIAS = {
      slug:   ['slug','Slug','SLUG'],
      title:  ['title','作品名','書名'],
      author: ['author','作者','著者']
    };
    const pick = (row, keys) => {
      for (const k of keys) {
        const v = row[k];
        if (v !== undefined && String(v).trim() !== '') return String(v).trim();
      }
      return '';
    };
    // 英数字以外を除去して正規化（保険）
    const cleanSlug = s => String(s).replace(/[^A-Za-z0-9]/g,'').trim();

    Papa.parse(CSV_URL, {
      download:true, header:true, skipEmptyLines:true, encoding:'utf-8',
      complete: ({data})=>{
        const items = data.map(r=>({
          slug:   cleanSlug(pick(r, ALIAS.slug)),
          title:  pick(r, ALIAS.title),
          author: pick(r, ALIAS.author)
        })).filter(x => x.slug && x.title && x.author);

        const wrap = document.getElementById('books');
        const frag = document.createDocumentFragment();

        items.forEach(it=>{
          const a = document.createElement('a');
          a.className = 'book';
          a.href = `works/${it.slug}.html`;
          a.innerHTML = `
            <div class="title">${it.title}</div>
            <div class="author">${it.author}</div>
            <div class="obi"></div>
          `;
          frag.appendChild(a);
        });

        while (frag.childNodes.length < 6) {
          const e = document.createElement('div');
          e.className = 'book empty';
          e.innerHTML = `<div class="obi"></div>`;
          frag.appendChild(e);
        }
        wrap.textContent = '';
        wrap.appendChild(frag);
      },
      error: err=>{
        console.error(err);
        document.getElementById('books').innerHTML = '<p style="color:#b00">データ読み込みに失敗しました。</p>';
      }
    });
  </script>
</body>
</html>
